{% extends "base.html" %} {% block content %}

<nav>
    <div class="nav-wrapper">
        <a href="/" class="brand-logo">SimpleBills</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="#" class='dropdown-button' data-activates='dropdown-profile'>{{ profile.nickname }}  <i class="material-icons">arrow_drop_down</i></a></li>
        </ul>
        <ul id='dropdown-profile' class='dropdown-content'>
            <li><a href="#!">Log Out</a></li>
        </ul>
    </div>
</nav>
<div id="side-nav">
    <ul class="side-nav fixed collection with-header z-depth-1">
        <li class="collection-header">
            <h5 class="headline-sub">YOUR ACCOUNTS<a class="modal-trigger waves-effect waves-teal btn-flat " id="btn-create" href="#create_account">create</a></h5>
        </li>
        {% for account in owner_accounts %}
        <li><a href="/account/{{account.accountId}}" class="collection-item {{ 'active' if account_id == account.accountId }}"> {{ account.name }}</a></li>
        {% endfor %}
        <li class="collection-header">
            <h5 class="headline-sub">SHARED ACCOUNTS</h5>
        </li>
        {% for account in editor_accounts %}
        <li><a href="/account/{{account.accountId}}" class="collection-item"> {{ account.name }}</a></li>
        {% endfor %}
    </ul>
</div>
{% include "create_account_modal.html" %}
<main>
    <div class="container">
        <div class="row">
            <div class="col s12">
                <div class="account_detail_headline">
                    <h4 class="headline-main col s4"><span id="account-name">{{account_name}}<span> <a href="/account/{{account_id}}/settings"><i class="material-icons">settings</i></span></h4>
                    <a class="waves-effect waves-light btn modal-trigger" href="#addBill">Add a bill</a>
                </div>

                <div ng-controller="AddBillController">
                <form action="/account/{{account_id}}/create_bill" method="post" enctype='multipart/form-data'>
                    <div id="addBill" class="modal modal-fixed-footer" ng-controller="AddBillController">
                        <div class="modal-content">
                            <h4> Add a Bill </h4>
                            <div class="input-field col s12">
                                <input id="bill_desc" ng-model="bill_desc" type="text" name="bill_desc">
                                <label for="bill_desc">Bill Title</label>
                            </div>

                            <div class="input-field col s2">
                                <select name="bill_currency_code">
                           {% for currency in supported_currencies %}
                           <option value={{currency}} {% if default_currency_code == currency %} selected {%endif%}> {{currency}} </option>
                           {% endfor %}
                         </select>
                                <label>Currency </label>
                            </div>
                            <div class="input-field col s6">
                                <input id="bill_amount" type="text" ng-model="bill_amount" name="bill_amount">
                                <label for="bill_amount">Bill Amount</label>
                            </div>

                            <div class="col s12">
                                <div class="bill_date col s6">
                                    <h3 class="headline-sub">Date</h3>
                                    <input class="col s8 " id="bill_date" name="bill_date" type="text">
                                </div>
                                <!-- date picker javascript -->
                                <script type="text/javascript">
                                    $(function() {
                                      $('#bill_date').daterangepicker({
                                          "singleDatePicker": true,
                                          "startDate": new Date(),
                                      });
                                    });
                                </script>
                                <!-- *************************** -->
                                <div class="col s4">
                                    <div class="file_input file-field input-field">
                                        <h3 class="headline-sub">Upload file</h3>
                                        <div class="btn add_file_btn">
                                            <i class="material-icons">add</i>
                                            <input type="file" name="filename">
                                        </div>
                                        <div class="file-path-wrapper">
                                            <input class="file-path validate col s12" type="text">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col s12">
                                <h3 class="headline-sub">Tags</h3> {% if account_tags %}
                                <div class="bill_tags_all">
                                    {% for tag in account_tags %}
                                    <div class="bill_tag">
                                        <input type="checkbox" name="bill_tags" value="{{tag}}" class="filled-in" id="{{tag}}" />
                                        <label for="{{tag}}">{{tag}}</label>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% else %}
                                <p class="helper-text">Add bill tags in account settings</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn modal-action" type="button" ng-click="submitForm($event)">Add</button>
                            <a href="" class="modal-action modal-close waves-effect waves-red btn-flat ">Cancel</a>
                        </div>
                    </div>
                </form>
                </div>

                {% if not has_bills %}
                <div class="card col s12" id="cold_start">
                    <p class="helper-info">
                        You dont have any bills in this account. Start adding by clicking 'ADD A BILL'.
                    </p>
                </div>
                {% else %}
                <div class="card col s12" id="search_table" ng-controller="SearchBillController">
                    <div id="spinner-container">
                        <div id="spinner" class="preloader-wrapper active">
                            <div class="spinner-layer spinner-green-only">
                                <div class="circle-clipper left">
                                    <div class="circle"></div>
                                </div>
                                <div class="gap-patch">
                                    <div class="circle"></div>
                                </div>
                                <div class="circle-clipper right">
                                    <div class="circle"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="search_box col s12">
                        <form>
                            <div id="reportrange" class="card">
                                <i class="material-icons">date_range</i>
                                <span></span>
                                <input id="end_date" type="hidden" ng-value="" ng-model="search_end_date">
                                <input id="start_date" type="hidden" ng-value="" ng-model-options="{ updateOn: 'change'}" ng-model="search_start_date">
                                <i class="material-icons">arrow_drop_down</i>
                            </div>

                            <div class="search-wrapper card col s6">
                                <input id="search_query" type="text" ng-model="search_query" ng-keypress="searchOnEnterKey($event)" name="search_query" placeholder="Search">
                                <i class="material-icons">search</i>
                            </div>

                            <div class="col s12">
                                <h3 class="headline-sub">Tags</h3> 
                                {% if account_tags %}
                                  <div class="bill_tags_all">
                                      <div class="bill_tag" ng-repeat="tag in accountTags">
                                          <input type="checkbox" name="search_tags" class="filled-in" id="search_#{tag}" ng-model="search_tags[tag]" />
                                          <label for="search_#{tag}">#{tag}</label>
                                      </div>
                                  </div>
                                {% else %}
                                  <p class="helper-text">Add bill tags in account settings</p>
                                {% endif %}
                            </div>
                            <div class="col s12 search_btn">
                                <button class="btn waves-effect waves-light btn-search" type="button" ng-click="fetchBills()">Search</button>
                            </div>
                        </form>

                        <div class="billsgi-table col s12">
                            <table class="bordered col s12">
                                <thead>
                                    <tr>
                                        <th data-field="id">Bill Title</th>
                                        <th data-field="name">Amount</th>
                                        <th data-field="Date">Date</th>
                                        <th data-field="Files">Files</th>
                                        <th data-field="Tags">Tags</th>
                                        <th data-field="Actions">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="bill in bills">
                                        <td>#{bill.desc}</td>
                                        <td>#{bill.currency_code} #{bill.amount}</td>
                                        <td>#{bill.date}</td>
                                        <td>
                                          <span ng-repeat="file in bill.files">
                                            <a href="#{file.signed_url}" target="_blank">#{file.filename}</a>
                                          </span>
                                        </td>
                                        <td>
                                          <span ng-repeat="tag in bill.tags">
                                            #{tag.data}
                                          </span>
                                        </td>
                                        <td><a href="/account/#{accountId}/#{bill.billId}/edit_bill" class="edit-btn"><i class="material-icons">edit</i></a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</main>

<script type="text/javascript">
    var PageConfig = {
        accountId: "{{account_id}}",
        accountTags: {{account_tags_json|safe}}
    };
</script>

{% endblock %}
